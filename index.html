<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		
		<!-- THEME UTILITY -->
		<link rel="stylesheet" href="./_themes/utils/loader.css" type="text/css">
		<!-- END THEME UTILITY -->
		<link rel="stylesheet" href="./css/main.css" type="text/css">
		<link rel="stylesheet" href="./css/menu.css" type="text/css">
		<link rel="stylesheet" href="./css/tests.css" type="text/css">
		<link rel="stylesheet" href="./css/test.css" type="text/css">
		<link rel="stylesheet" href="./css/slidingpanels.css" type="text/css">
		<title>Take a note</title>

		<style>
			body, html 
			{
				background-color: #190800;
			}
			#inputPane { 
		        margin-top: 2px;
		        
		        position: absolute;

		        width:100%;
		    }
			#wrapper 
			{
				position: relative;
				z-index: 1;
				width: 100%;
				background-color: #190800;
				overflow: hidden;
			}
			
			#scrollContent 
			{
				position: relative;
				height: 100%;
			}
			
			.item 
			{
				float: left;
				
			}
			
			.item .image 
			{
				float: left;
				
				margin-right: 10px;
				
				width: 80px;
				height: 60px;
			}
		</style>
		
		<!-- THEME UTILITY -->
		<!-- <script type="text/javascript" src="./_themes/utils/loader.js"></script> -->
		<!-- END THEME UTILITY -->
		
		<!-- CORE -->
		<!-- Can be replaced by wink.min.js -->
<script src="./acebuild/ace.js" type="text/javascript" charset="utf-8"></script>

<script defer type="text/javascript" src="./wink/_cache/js/wink.cache.js"></script>
	<script defer type="text/javascript" src="./wink/_cache/js/wink.cache.localStorage.js"></script>
		 <script defer type="text/javascript" src="./wink/_cache/js/wink.cache.sqlDatabase.js"></script>
		
<script type="text/javascript" src="showdown.js"></script>
	<script type="text/javascript" src="showdown-gui.js"></script>
	
		<script type="text/javascript">
			var mevernote = {};	
			var storage;
			var editor;
			var slidingPanels;
			var currentNote;
			var properties = 
			{
				'duration': 500,
				'pages': ['noteslist', 'edit_note']
			}
		
			slide = function(id)
			{
				slidingPanels.slideTo(id);
			}	

			slideBack = function(id)
			{
				console.log(currentNote)
				var value = editor.getValue();
				if(currentNote=='new'){
					storage.insert('note', {title:value.substring(0,18)+'...', markdown:value});
				}else{
					storage.update('note', {id:currentNote.id, title:value.substring(0,18)+'...', markdown:value});
				}
				
				slidingPanels.slideBack();
				getNotes();
			}	

			changeTitle = function(params)
			{
				switch (params.id)
				{
					case 'noteslist':
						wink.byId('back').style.visibility = 'hidden';
						wink.byId('option_toggle').style.visibility = 'hidden';
						
						break;
					default:
						wink.byId('back').style.visibility = 'visible';
						wink.byId('option_toggle').style.visibility = 'visible';
				}
				
				wink.byId('title').innerHTML = 'Title: ' + params.id;
			}	
			
			focusEditor = function()
			{
				// editor.clearSelection();
				// editor.focus()
				// convertText();
			}
			fillText = function(note)
			{
				currentNote=note;
				editor.setValue(note.markdown);
				focusEditor();
				
			}
			showNote = function(id)
			{
				slide('edit_note');
				
				storage.getById('note', id,{context:null,method:'fillText'});
				
			}
			onNotesList = function(mevernote)
			{
				var sectionNode = wink.byId('content')
					// wink.addClass(sectionNode, 'w_list w_border w_radius');
				sectionNode.innerHTML=''
				// create note
				var node = document.createElement('li')
						wink.addClass(node,'w_list_item w_border_bottom w_bg_light');

				node.innerHTML = '<a href="#" onclick="addNewNote()"><label>Create New Note</label></a>';
				sectionNode.appendChild(node);
				if (mevernote.length > 0) 
				{

					

					// var title = document.createElement('li');
					// wink.addClass(title, 'w_list_item w_list_header w_border_bottom w_bg_dark');
					// title.innerHTML = 'Notes List';

					// // wink.byId('list1').appendChild(sectionNode);
					// sectionNode.appendChild(title);
					for(var i=0; i<mevernote.length; i++)
					{
						var node = document.createElement('li')
						wink.addClass(node,'w_list_item w_border_bottom w_bg_light');

						node.innerHTML = '<a href="#" onclick="showNote('+mevernote[i].id+')"><label>'+mevernote[i].title+'</label></a><span class="w_icon w_chevron"></span>';
						sectionNode.insertBefore(node,sectionNode.firstChild.nextSibling);
					}
				} else 
				{
					// var node = document.createElement('li')
					// wink.addClass(node,'w_list_item w_border_bottom w_bg_light');
					// node.innerHTML = "<label>"+mevernote[i].title+"</label>";
					// sectionNode.appendChild(node);
					console.log('empty')
				}

			}

			mailToEvernote = function()
			{
				if("undefind" == typeof blackberry){
									try {
										remote = new blackberry.transport.RemoteFunctionCall("blackberry/invoke/invoke");

										subject = "Hello World!";
										body = "Let's do this thing!";
										alert(body)
										remote.addParam("appType", "mailto:?Subject=" + encodeURIComponent(subject) + "&body=" + encodeURIComponent(body));

										remote.makeAsyncCall();
									} catch (err) {
										console.write("fire: " + err);
									}
				}
				else{
					window.open('mailto:oyanglulu@gmail.com')
				}
			}
			addNewNote = function(title,markdown)
			{
				slide('edit_note');
				editor.setValue('');
				focusEditor();
				currentNote = 'new'
				
				// storage.insert('note', {title:'title',markdown:'markdown'},{context:null,method:'getNotes'});
			}

			getNotes = function()
			{
				storage.getList('note', {context: null, method: 'onNotesList'});
			}
			
			var useLocalDatabase = true;
			
			var resources =
			[
				{ url: './js/wink-1.4.2-kitchensink-default.min.js', type: 'js', group: 0 },
				{ url: './js/main.js', type: 'js', group: 1 },
				{ url: './slidingpanels.js', type: 'js', group: 2 },

				{ url: './wink/api/storage/js/storage.js', type: 'js', group: 2 },
				{ url: './wink/api/storage/js/safaridb.js', type: 'js', group: 2 },
				{ url: './wink/api/storage/js/gearsdb.js', type: 'js', group: 2 },
				// { url: './ux/movementtracker/js/movementtracker.js', type: 'js', group: 2 },
				{ url: './bookmarkClipper.js', type: 'js', group: 2 },
				{ url: './acebuild/ace.js', type: 'js', group: 2 },
				{ url: './js/config.js', type: 'js', group: 2 },
				{ url: './js/splash.js', type: 'js', group: 2 },
				{ url: './js/navigation.js', type: 'js', group: 2 },
				{ url: './js/options.js', type: 'js', group: 2 },
				{ url: './js/list.js', type: 'js', group: 2 },
				{ url: './js/test.js', type: 'js', group: 2 },
				{ url: './js/utils.js', type: 'js', group: 2 },
				
				{ url: './css/wink-1.4.2-kitchensink-default.min.css', type: 'css', group: 0 },
				
				{ url: './css/main.css', type: 'css', group: 0 },
				{ url: './css/splash.css', type: 'css', group: 0 },
				{ url: './css/menu.css', type: 'css', group: 0 },
				{ url: './css/tests.css', type: 'css', group: 0 },
				{ url: './css/test.css', type: 'css', group: 0 }
			];
			
			(function() {
				
						
						
				window.addEventListener('DOMContentLoaded', function()
				{
					wink.load(resources, function()
					{
						ks.main.init();
						slidingPanels = new wink.ui.layout.SlidingPanels(properties);

						wink.subscribe('/slidingpanels/events/slidestart', {method: 'changeTitle'});
						wink.subscribe('/slidingpanels/events/slideend', {method: 'changeTitle'});
						
						wink.byId('list').appendChild(slidingPanels.getDomNode());
						storage = new wink.api.Storage();	
						// Database descriptor
						descriptor =
						{
							name : 'notesdb',
							tables :
							{
								note :
								{
									title : wink.api.storage.fieldtypes.TEXT,
									markdown : wink.api.storage.fieldtypes.TEXT,

								}

							}
						}
						storage.connect(descriptor);
						getNotes();
						
						console.log('hreere2')
						editor = ace.edit("inputPane");
    					editor.setTheme("ace/theme/twilight");
    					editor.getSession().setMode("ace/mode/javascript");
						console.log('here first')
						startGui();
					}, 
					{
						enable: useLocalDatabase,
						storage: 'localStorage'
					});
				}, false);

			})();
			
			var headerHeight = 110;
        	// scrollerHelper.goToItem(1);   
        	
			
		</script>
	</head>
	
<body>
		<!-- <div id="orientation" style="visibility: hidden">
			<span style="font-size: 20px;">Wink kitchensink</span>
			<br />
			<br />
			Of course... Wink can also handle orientation changes ;)
		</div> -->
		<div id="wrapper" class="wrapper" style="visibility: hidden">
			<div id="splash">
				<div>
					<img id="logo" src="./images/logo.png" />
				</div>
				<span style="position: absolute; bottom: -15px; right: -15px; font-size: 118px; color: #343333">Mevernote</span>
			</div>
			
			<div id="options" class="panel">
				<div style="height: 35px; width: 90%; border-bottom: 1px dashed #999; padding-top: 8px; margin-left: 15px">
					<span class="letters">
						<span class="firstLetter">A</span>bout	
					</span>
				</div>
				<div id="about_scroller" class="wrapper">
					<div id="aboutContent">
						<textarea id="syntaxPane" class="w_textarea w_border w_radius w_bg_dark" cols="80" rows="20" readonly="readonly" style="width: 100%; "></textarea>
							<div id="previewPane" class="pane"></div>
							<textarea id="outputPane" class="w_textarea w_border w_radius w_bg_dark" cols="80" rows="20" readonly="readonly" style="width: 100%; "></textarea>
					</div>

				</div>
			</div>
			
			<div id="container">
				<div id="tests" class="panel">
					<div class="header">
						<a href="#" id="option_toggle" onclick="ks.options.toggle()" style="visibility:hidden">
							<img src="./images/menu.png" />
						</a>
						<a href="#" id="back" onclick="slideBack();" style="visibility:hidden;">
							<img src="./images/back.png" height="44px">
						</a>
						<!-- <a href="#" id="new_note" onclick="ks.options.toggle()" style="visibility:visible">
							<img src="./images/icon/glyphicons_030_pencil.png" />
						</a> -->
						<span class="letters" style="position: absolute; bottom: 2px; right: 5px">
							<span class="firstLetter">M</span>evernote
						</span>
					</div>
					 <div id="navigation">
						<div id="menu">
							<span id="convertTextControls">
								<!-- <button id="convertTextButton" type="button" title="Convert text now">
									Convert text
								</button> -->
								<span class="subtitle">Options:</span>
								<br>
								<button id="convertTextButton">Convert:</button>
								<select id="convertTextSetting">
									<option value="delayed">in the background</option>
									<option value="continuous">every keystroke</option>
									<option value="manual">manually</option>
								</select>
									<br>
								<label>Side View:</label>
					      		<select id="paneSetting">
									<option value="previewPane">Preview</option>
									<option value="outputPane">HTML Output</option>
									<option value="syntaxPane">Syntax Guide</option>
								</select>
								<br>
								<input type="mail" id="evernote-mail"/>
								<button onclick="mailToEvernote();">Evernote</button>
							</span>
						</div> 
						<div id="handlebar">
							<img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" />
						</div>
					</div>
					<div id="loader" class="w_window w_border w_radius w_bg_dark asp_loader">
						<div class="asp_text">loading...</div>
					</div>
					<div id="list">
						<!-- <div id="tests_scroller" class="wrapper">
							<div id="scrollContent">
								<ul id="content" class="w_list w_border content">
								</ul>
							</div>
						</div> -->
					</div>
				</div>
				<div id="test" class="panel">
					<div class="header">
						<a href="#" onclick="ks.list.show()">
							<img src="./images/back.png" height="44px" />
						</a>
						<div id="title"></div>
					</div>
					<div id="testContent">
						<div id="tests_scroller" class="wrapper">
							<div id="scrollContent">
								
							</div>
						</div>
					</div>
				</div>
			</div> <!-- end container -->
			<div class="w_box" id="noteslist">
				<div class="page">
					<div id="tests_scroller" class="wrapper">
							<div id="scrollContent">
								<ul id="content" class="w_list w_border content">
									<li class="w_list_item w_border_bottom w_bg_light">
										<a href="#" onclick="slide('edit_note')">Go to next page</a>
										<span class="w_icon w_chevron"></span>
									</li>
									<li class="w_list_item w_border_bottom w_bg_light">
										<a href="#" onclick="slide('page3')">Go to page 3</a>
										<span class="w_icon w_chevron"></span>
									</li>
								</ul>
							</div>
						</div> 
				</div>
			</div>
			<div class="w_box" id="edit_note">
				<div class="page">
					
									<pre id="inputPane"></pre>
								
				</div>
			</div>


		</div> <!-- end wrapper -->
	</body>
</html>
